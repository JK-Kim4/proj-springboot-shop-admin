<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.changbi.magazineadmin.repository.mysql.WeeklyCommentRepository">

    <select id="selectWCAll" resultType="weeklyComment">
        SELECT
            *
        FROM
            WEEKLY_COMMENT
        ORDER BY WEEKLY_SEQ DESC
    </select>

    <select id="selectWeeklyCommentAuthor" parameterType="int" resultType="WeeklyMeta">
        SELECT
            A.AUTHOR_SEQ
            ,B.AUTHOR_KR_NAME
        FROM AUTHOR_WEEKLY A
        INNER JOIN AUTHOR B
        ON A.AUTHOR_SEQ = B.AUTHOR_SEQ
        WHERE A.WEEKLY_SEQ = #{weeklySeq}
    </select>

    <select id="selectWeeklyCommentBySeq" parameterType="int" resultType="weeklyComment">
        <![CDATA[
        SELECT *
        FROM WEEKLY_COMMENT
        WHERE WEEKLY_SEQ = #{weeklySeq}
        ]]>
    </select>

    <insert id="insertWeeklyComment" parameterType="weeklyComment"
            useGeneratedKeys="true" keyProperty="weeklySeq" keyColumn="WEEKLY_SEQ">
    <![CDATA[
        INSERT INTO WEEKLY_COMMENT (
            WEEKLY_TITLE
            ,WEEKLY_SUBTITLE
            ,WEEKLY_CONTENT
            ,WEEKLY_THUMGNAIL_IMAGE
            ,WEEKLY_THUMGNAIL_IMAGE_FILE_NAME
            ,APPEND_DATE
            ,UPDATE_DATE
            ,VIEW_COUNT
            ,USE_YN
        ) VALUES (
            #{weeklyTitle}
            ,#{weeklySubtitle}
            ,#{weeklyContent}
            ,#{weeklyThumbnailImage}
            ,#{weeklyThumbnailImageFileName}
            ,now()
            ,now()
            ,0
            ,#{useYn}
        )
    ]]>
    </insert>

    <insert id="insertWeeklyAuthor" parameterType="WeeklyMeta">
        <![CDATA[
        INSERT INTO AUTHOR_WEEKLY
        (
            AUTHOR_SEQ
            ,WEEKLY_SEQ
        )VALUES
        ]]>
        <foreach collection="list" item="item" separator=",">
        <![CDATA[
        (
            #{item.authorSeq}
            ,#{item.weeklySeq}
        )
        ]]>
        </foreach>
    </insert>

    <update id="updateWeeklyComment" parameterType="weeklyComment">
        <![CDATA[
        UPDATE WEEKLY_COMMENT
        SET
            WEEKLY_TITLE = #{weeklyTitle}
          ,WEEKLY_SUBTITLE = #{weeklySubtitle}
          ,WEEKLY_CONTENT = #{weeklyContent}
          ,WEEKLY_THUMGNAIL_IMAGE = #{weeklyThumbnailImage}
          ,WEEKLY_THUMGNAIL_IMAGE_FILE_NAME = #{weeklyThumbnailImageFileName}
          ,UPDATE_DATE = now()
          ,USE_YN = #{useYn}
        WHERE WEEKLY_SEQ = #{weeklySeq}
        ]]>
    </update>

    <delete id="deleteWeeklyAuthor" parameterType="int">
        DELETE FROM AUTHOR_WEEKLY
        WHERE WEEKLY_SEQ = #{weeklySeq}
    </delete>

</mapper>